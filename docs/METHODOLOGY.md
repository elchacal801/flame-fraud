# FLAME Detection Methodology

## Typosquat Detection

### Pipeline

1. **dnstwist fuzzing** (`scripts/generate_permutations.py`): Generates domain permutations (homoglyph, addition, bitsquatting, etc.) for target brands listed in `config/targets.txt`
2. **DNS resolution**: dnstwist resolves A, AAAA, MX, NS records for each permutation to identify live domains
3. **Cross-reference** (`scripts/enrich_dnstwist.py`): Joins live typosquat domains against the main pipeline CSV, adding `dnstwist_match`, `dnstwist_fuzzer`, `dnstwist_target`, and derived evasion signals
4. **Fingerprinting** (`scripts/match_fingerprints.py`): FP-0007 evaluates cross-referenced domains for evasion indicators (redirects to brand, registrant mismatch, parked pages, etc.)

### Evasion Signals

| Signal | Source | Meaning |
|--------|--------|---------|
| `redirects_to_brand` | probe_web.py redirect capture + enrich_dnstwist.py | Domain 301/302 redirects to the brand it impersonates |
| `registrant_mismatch` | WHOIS data + enrich_dnstwist.py | Domain registrant does not contain the brand name |
| `ssl_present` | probe_web.py HTTPS probe | Domain has a valid TLS certificate (operational investment) |
| Parked/sale page | probe_web.py title extraction | Domain title matches parked/sale patterns |

### Known Limitations

- **No Levenshtein scoring**: The current pipeline uses exact dnstwist fuzzer matching, not edit-distance scoring. A domain that visually resembles a brand but wasn't generated by dnstwist will not be detected.
- **Geo-targeted content**: `probe_web.py` probes from a single geographic location (the GitHub Actions runner region). Domains serving different content to different regions will only show the runner's view.
- **Registrant heuristic**: Brand-name-in-registrant matching is a case-insensitive substring check. It will miss registrants using abbreviations, parent company names, or privacy services.
- **targets.txt dependency**: Only brands listed in `config/targets.txt` are fuzzed. New brands must be manually added.
